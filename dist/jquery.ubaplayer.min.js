/*! UbaPlayer - v1.0.1 - 2012-05-31
* https://github.com/brianhadaway/UbaPlayer
* Copyright (c) 2012 Brian Hadaway; Licensed MIT, GPL */
(function(a){var b={audioButtonClass:"audioButton",autoPlay:null,codecs:[{name:"OGG",codec:'audio/ogg; codecs="vorbis"'},{name:"MP3",codec:"audio/mpeg"}],continuous:!1,extension:null,flashAudioPlayerPath:"libs/swf/player.swf",flashExtension:".mp3",flashObjectID:"audioPlayer",loadingClass:"loading",loop:!1,playerContainer:"player",playingClass:"playing",swfobjectPath:"libs/swfobject/swfobject.js",volume:.5},c,d=!1,e=!1,f,g,h,i,j,k,l,m={play:function(a){h=a,c=n.getFileNameWithoutExtension(h.attr("href")),d=!0,h.addClass(b.loadingClass),g.removeClass(b.playingClass),e?(f&&n.removeListeners(window),console.log("defaults.flashObjectID",b.flashObjectID),f=document.getElementById(b.flashObjectID),n.addListeners(window),f.playFlash(c+b.extension)):(f&&(f.pause(),n.removeListeners(f)),f=new Audio(""),n.addListeners(f),f.id="audio",f.loop=b.loop?"loop":"",f.volume=b.volume,f.src=c+b.extension,f.play())},pause:function(){e?f.pauseFlash():f.pause(),h.removeClass(b.playingClass),d=!1},resume:function(){e?f.playFlash():f.play(),h.addClass(b.playingClass),d=!0},playing:function(){return d}},n={init:function(c){var d;a.extend(b,c),i=this,a(".controls").bind("click",function(a){return n.updateTrackState(a),!1}),g=a("."+b.audioButtonClass),d=b.codecs;for(var f=0,h=d.length;f<h;f++){var j=d[f];if(n.canPlay(j)){b.extension=[".",j.name.toLowerCase()].join("");break}}if(!b.extension||e)e=!0,b.extension=b.flashExtension;e?(i.html("<div id='"+b.playerContainer+"'/>"),a.getScript(b.swfobjectPath,function(){swfobject.embedSWF(b.flashAudioPlayerPath,b.playerContainer,"0","0","9.0.0","swf/expressInstall.swf",!1,!1,{id:b.flashObjectID},n.swfLoaded)})):b.autoPlay&&m.play(b.autoPlay)},updateTrackState:function(b){h=a(b.target);if(!h.hasClass("audioButton"))return;!f||f&&c!==n.getFileNameWithoutExtension(h.attr("href"))?m.play(h):d?m.pause():m.resume()},addListeners:function(b){a(b).bind({canplay:n.onLoaded,error:n.onError,ended:n.onEnded})},removeListeners:function(b){a(b).unbind({canplay:n.onLoaded,error:n.onError,ended:n.onEnded})},onLoaded:function(){g.removeClass(b.loadingClass),h.addClass(b.playingClass),f.play()},onError:function(){g.removeClass(b.loadingClass),e?n.removeListeners(window):n.removeListeners(f)},onEnded:function(){d=!1,h.removeClass(b.playingClass),c="",e?n.removeListeners(window):n.removeListeners(f);if(b.continuous){var g=h.next().length?h.next():a(b.audioButtonClass).eq(0);m.play(g)}},canPlay:function(a){return document.createElement("audio").canPlayType?document.createElement("audio").canPlayType(a.codec).match(/maybe|probably/i)?!0:!1:!1},swfLoaded:function(){b.autoPlay&&setTimeout(function(){m.play(b.autoPlay)},500)},getFileNameWithoutExtension:function(a){var b=a.split(".");return b[0]}};a.fn.ubaPlayer=function(b){if(m[b])return m[b].apply(this,Array.prototype.slice.call(arguments,1));if(typeof b=="object"||!b)return n.init.apply(this,arguments);a.error("Method "+b+" does not exist on jquery.ubaPlayer")}})(jQuery);