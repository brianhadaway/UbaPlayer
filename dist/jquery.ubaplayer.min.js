/*! UbaPlayer - v1.0.1 - 2013-07-22
* https://github.com/brianhadaway/UbaPlayer
* Copyright (c) 2013 Brian Hadaway; Licensed MIT, GPL */
(function(e){var t={audioButtonClass:"audioButton",autoPlay:null,codecs:[{name:"OGG",codec:'audio/ogg; codecs="vorbis"'},{name:"MP3",codec:"audio/mpeg"}],continuous:!1,extension:null,flashAudioPlayerPath:"libs/swf/player.swf",flashExtension:".mp3",flashObjectID:"audioPlayer",loadingClass:"loading",loop:!1,playerContainer:"player",playingClass:"playing",swfobjectPath:"libs/swfobject/swfobject.js",volume:.5,fallbackFunctions:{play:null,pause:null,resume:null,error:null},fallbackExtension:".mid"},n,r=!1,i=!1,s=!1,o,u,a,f,l,c,h,p={play:function(e){a=e,n=d.getFileNameWithoutExtension(a.attr("href")),r=!0,a.addClass(t.loadingClass),u.removeClass(t.playingClass),s?typeof t.fallbackFunctions.play=="function"&&t.fallbackFunctions.play(n+t.fallbackExtension):i?(o&&d.removeListeners(window),o=document.getElementById(t.flashObjectID),d.addListeners(window),o.playFlash(n+t.extension)):(o&&(o.pause(),d.removeListeners(o)),o=new Audio(""),d.addListeners(o),o.id="audio",o.loop=t.loop?"loop":"",o.volume=t.volume,o.src=n+t.extension,o.play())},pause:function(){s?typeof t.fallbackFunctions.pause=="function"&&t.fallbackFunctions.pause():i?o.pauseFlash():o.pause(),a.removeClass(t.playingClass),r=!1},resume:function(){s?typeof t.fallbackFunctions.resume=="function"&&t.fallbackFunctions.resume():i?o.playFlash():o.play(),a.addClass(t.playingClass),r=!0},playing:function(){return r}},d={init:function(n){var r;e.extend(t,n),f=this,e(".controls").bind("click",function(e){return d.updateTrackState(e),!1}),u=e("."+t.audioButtonClass),r=t.codecs;for(var s=0,o=r.length;s<o;s++){var a=r[s];if(d.canPlay(a)){t.extension=[".",a.name.toLowerCase()].join("");break}}if(!t.extension||i)i=!0,t.extension=t.flashExtension;i?(f.html("<div id='"+t.playerContainer+"'/>"),e.getScript(t.swfobjectPath,function(){swfobject.embedSWF(t.flashAudioPlayerPath,t.playerContainer,"0","0","9.0.0","swf/expressInstall.swf",!1,!1,{id:t.flashObjectID},d.swfLoaded)})):t.autoPlay&&p.play(t.autoPlay)},updateTrackState:function(t){a=e(t.target);if(!a.hasClass("audioButton"))return;!o||o&&n!==d.getFileNameWithoutExtension(a.attr("href"))?p.play(a):r?p.pause():p.resume()},addListeners:function(t){e(t).bind({canplay:d.onLoaded,error:d.onError,ended:d.onEnded})},removeListeners:function(t){e(t).unbind({canplay:d.onLoaded,error:d.onError,ended:d.onEnded})},onLoaded:function(){u.removeClass(t.loadingClass),a.addClass(t.playingClass),o.play()},onError:function(){u.removeClass(t.loadingClass),i?d.removeListeners(window):d.removeListeners(o)},onEnded:function(){r=!1,a.removeClass(t.playingClass),n="",i?d.removeListeners(window):d.removeListeners(o);if(t.continuous){var s=a.next().length?a.next():e(t.audioButtonClass).eq(0);p.play(s)}},canPlay:function(e){return document.createElement("audio").canPlayType?document.createElement("audio").canPlayType(e.codec).match(/maybe|probably/i)?!0:!1:!1},swfLoaded:function(e){e.success||(i=!1,s=!0,typeof t.fallbackFunctions.error=="function"&&t.fallbackFunctions.error()),t.autoPlay&&setTimeout(function(){p.play(t.autoPlay)},500)},getFileNameWithoutExtension:function(e){var t=e.split(".");return t.pop(),t.join(".")}};e.fn.ubaPlayer=function(t){if(p[t])return p[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return d.init.apply(this,arguments);e.error("Method "+t+" does not exist on jquery.ubaPlayer")}})(jQuery);